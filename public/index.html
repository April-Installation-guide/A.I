<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mancy AI - Panel de Control</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Roboto+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --primary-light: #818cf8;
            --secondary: #10b981;
            --secondary-dark: #059669;
            --danger: #ef4444;
            --danger-dark: #dc2626;
            --warning: #f59e0b;
            --warning-dark: #d97706;
            --dark-bg: #0f172a;
            --dark-card: #1e293b;
            --darker-card: #1e293b;
            --border: #334155;
            --text-primary: #f8fafc;
            --text-secondary: #cbd5e1;
            --text-tertiary: #94a3b8;
            --gradient-primary: linear-gradient(135deg, var(--primary), var(--primary-dark));
            --gradient-secondary: linear-gradient(135deg, var(--secondary), var(--secondary-dark));
            --gradient-danger: linear-gradient(135deg, var(--danger), var(--danger-dark));
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --glow-primary: 0 0 20px rgba(99, 102, 241, 0.3);
            --glow-secondary: 0 0 20px rgba(16, 185, 129, 0.3);
            --radius: 12px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: var(--dark-bg);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(99, 102, 241, 0.1) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(16, 185, 129, 0.1) 0%, transparent 20%);
        }

        /* Scrollbar personalizada */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        ::-webkit-scrollbar-track {
            background: var(--dark-card);
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-light);
        }

        .app-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            margin-bottom: 30px;
            border-bottom: 2px solid var(--border);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-icon {
            width: 50px;
            height: 50px;
            background: var(--gradient-primary);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            box-shadow: var(--glow-primary);
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .logo-text h1 {
            font-size: 28px;
            font-weight: 700;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .logo-text .subtitle {
            color: var(--text-secondary);
            font-size: 14px;
            margin-top: 5px;
        }

        .connection-status {
            display: flex;
            align-items: center;
            gap: 15px;
            background: var(--dark-card);
            padding: 12px 24px;
            border-radius: var(--radius);
            border: 1px solid var(--border);
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--danger);
            box-shadow: 0 0 10px var(--danger);
            animation: pulse 2s infinite;
        }

        .status-dot.online {
            background: var(--secondary);
            box-shadow: 0 0 10px var(--secondary);
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Dashboard Grid */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        /* Cards */
        .card {
            background: var(--dark-card);
            border-radius: var(--radius);
            border: 1px solid var(--border);
            padding: 25px;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--gradient-primary);
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .card-title {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 18px;
            font-weight: 600;
        }

        .card-title i {
            color: var(--primary);
            font-size: 20px;
        }

        /* Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        .stat-card {
            background: var(--darker-card);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border: 1px solid var(--border);
            transition: var(--transition);
        }

        .stat-card:hover {
            background: var(--dark-card);
            transform: scale(1.05);
        }

        .stat-value {
            font-size: 32px;
            font-weight: 800;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 10px 0;
            font-family: 'Roboto Mono', monospace;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 14px;
            font-weight: 500;
        }

        /* Buttons */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-size: 14px;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn-primary {
            background: var(--gradient-primary);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--glow-primary);
        }

        .btn-success {
            background: var(--gradient-secondary);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: var(--glow-secondary);
        }

        .btn-danger {
            background: var(--gradient-danger);
            color: white;
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 20px rgba(239, 68, 68, 0.3);
        }

        .btn-secondary {
            background: var(--dark-card);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            background: var(--darker-card);
            border-color: var(--primary);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        .btn-group {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        /* Progress Bars */
        .progress-container {
            margin-top: 20px;
        }

        .progress-item {
            margin-bottom: 15px;
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .progress-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--gradient-primary);
            border-radius: 4px;
            width: 0%;
            transition: width 1s ease-in-out;
        }

        /* API Cards */
        .api-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .api-card {
            background: var(--darker-card);
            padding: 20px;
            border-radius: 10px;
            border: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 15px;
            transition: var(--transition);
        }

        .api-card:hover {
            background: var(--dark-card);
            border-color: var(--primary);
            transform: translateY(-3px);
        }

        .api-icon {
            width: 40px;
            height: 40px;
            background: var(--gradient-primary);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        .api-info {
            flex: 1;
        }

        .api-name {
            font-weight: 600;
            margin-bottom: 5px;
            font-size: 14px;
        }

        .api-status {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 12px;
        }

        .status-dot-small {
            width: 6px;
            height: 6px;
            border-radius: 50%;
        }

        .online { color: var(--secondary); }
        .offline { color: var(--danger); }

        /* Logs */
        .logs-container {
            background: var(--darker-card);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid var(--border);
        }

        .log-entry {
            padding: 12px 15px;
            margin-bottom: 8px;
            background: var(--dark-card);
            border-radius: 8px;
            border-left: 3px solid var(--primary);
            font-family: 'Roboto Mono', monospace;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: var(--transition);
        }

        .log-entry:hover {
            background: var(--darker-card);
            transform: translateX(5px);
        }

        .log-time {
            color: var(--secondary);
            font-weight: 600;
            min-width: 80px;
            font-size: 12px;
        }

        .log-message {
            flex: 1;
            color: var(--text-primary);
        }

        .log-type {
            padding: 3px 10px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .log-type.info { background: rgba(99, 102, 241, 0.2); color: var(--primary); }
        .log-type.success { background: rgba(16, 185, 129, 0.2); color: var(--secondary); }
        .log-type.warning { background: rgba(245, 158, 11, 0.2); color: var(--warning); }
        .log-type.error { background: rgba(239, 68, 68, 0.2); color: var(--danger); }

        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 16px 24px;
            border-radius: var(--radius);
            color: white;
            font-weight: 500;
            z-index: 1000;
            transform: translateX(150%);
            transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            max-width: 400px;
            box-shadow: var(--shadow-lg);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            background: var(--gradient-secondary);
            border-left: 4px solid var(--secondary);
        }

        .notification.error {
            background: var(--gradient-danger);
            border-left: 4px solid var(--danger);
        }

        .notification.info {
            background: var(--gradient-primary);
            border-left: 4px solid var(--primary);
        }

        /* Footer */
        .footer {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid var(--border);
            text-align: center;
            color: var(--text-tertiary);
            font-size: 14px;
        }

        .footer-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .header {
                flex-direction: column;
                gap: 20px;
                align-items: flex-start;
            }
            
            .btn-group {
                flex-direction: column;
                width: 100%;
            }
            
            .btn {
                width: 100%;
            }
        }

        @media (max-width: 480px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .app-container {
                padding: 10px;
            }
            
            .card {
                padding: 20px;
            }
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Server Info */
        .server-info {
            display: flex;
            gap: 20px;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid var(--border);
            font-size: 12px;
            color: var(--text-tertiary);
        }

        .server-info-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <div class="logo-icon">
                    <i class="fas fa-brain"></i>
                </div>
                <div class="logo-text">
                    <h1>Mancy AI</h1>
                    <div class="subtitle">Panel de Control Inteligente</div>
                </div>
            </div>
            
            <div class="connection-status">
                <div class="status-dot" id="statusDot"></div>
                <span id="statusText">Conectando al servidor...</span>
                <button class="btn btn-secondary" onclick="refreshAll()">
                    <i class="fas fa-sync-alt"></i> Actualizar
                </button>
            </div>
        </header>

        <!-- Dashboard Grid -->
        <main class="dashboard-grid">
            <!-- Card 1: Estado del Bot -->
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-robot"></i>
                        Estado del Bot
                    </h3>
                    <div class="btn-group">
                        <button class="btn btn-success" id="startBtn" onclick="controlBot('start')">
                            <i class="fas fa-play"></i> Iniciar
                        </button>
                        <button class="btn btn-danger" id="stopBtn" onclick="controlBot('stop')">
                            <i class="fas fa-stop"></i> Detener
                        </button>
                    </div>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Mensajes</div>
                        <div class="stat-value" id="messageCount">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Comandos</div>
                        <div class="stat-value" id="commandCount">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Usuarios</div>
                        <div class="stat-value" id="userCount">0</div>
                    </div>
                </div>

                <div class="progress-container">
                    <div class="progress-item">
                        <div class="progress-header">
                            <span>Uso de Memoria</span>
                            <span id="memoryPercent">0%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="memoryBar"></div>
                        </div>
                    </div>
                    <div class="progress-item">
                        <div class="progress-header">
                            <span>Uptime</span>
                            <span id="uptimeText">0s</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="uptimeBar"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Card 2: Servidores y Memoria -->
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-server"></i>
                        Sistema
                    </h3>
                    <span class="badge" id="serverCount">0 servidores</span>
                </div>
                
                <div class="api-grid">
                    <div class="api-card">
                        <div class="api-icon">
                            <i class="fas fa-discord"></i>
                        </div>
                        <div class="api-info">
                            <div class="api-name">Discord API</div>
                            <div class="api-status" id="discordStatus">
                                <span class="status-dot-small"></span>
                                Desconectado
                            </div>
                        </div>
                    </div>
                    
                    <div class="api-card">
                        <div class="api-icon">
                            <i class="fas fa-brain"></i>
                        </div>
                        <div class="api-info">
                            <div class="api-name">Groq AI</div>
                            <div class="api-status" id="groqStatus">
                                <span class="status-dot-small"></span>
                                Desconectado
                            </div>
                        </div>
                    </div>
                    
                    <div class="api-card">
                        <div class="api-icon">
                            <i class="fas fa-memory"></i>
                        </div>
                        <div class="api-info">
                            <div class="api-name">Memoria</div>
                            <div class="api-status" id="memoryStatus">
                                <span class="status-dot-small"></span>
                                <span id="memoryUsers">0 usuarios</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="api-card">
                        <div class="api-icon">
                            <i class="fas fa-plug"></i>
                        </div>
                        <div class="api-info">
                            <div class="api-name">Panel Web</div>
                            <div class="api-status online">
                                <span class="status-dot-small"></span>
                                Conectado
                            </div>
                        </div>
                    </div>
                </div>

                <div class="server-info">
                    <div class="server-info-item">
                        <i class="fas fa-microchip"></i>
                        <span>CPU: <span id="cpuUsage">0%</span></span>
                    </div>
                    <div class="server-info-item">
                        <i class="fas fa-memory"></i>
                        <span>RAM: <span id="ramUsage">0MB</span></span>
                    </div>
                    <div class="server-info-item">
                        <i class="fas fa-clock"></i>
                        <span>Ping: <span id="pingTime">0ms</span></span>
                    </div>
                </div>
            </div>

            <!-- Card 3: Logs en Tiempo Real -->
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-terminal"></i>
                        Logs del Sistema
                    </h3>
                    <div class="btn-group">
                        <button class="btn btn-secondary" onclick="clearLogs()">
                            <i class="fas fa-trash"></i>
                        </button>
                        <button class="btn btn-secondary" onclick="toggleAutoRefresh()">
                            <i class="fas fa-sync-alt" id="autoRefreshIcon"></i>
                        </button>
                    </div>
                </div>
                
                <div class="logs-container" id="logsContainer">
                    <div class="log-entry">
                        <div class="log-time">--:--:--</div>
                        <div class="log-message">Inicializando sistema...</div>
                        <div class="log-type info">INFO</div>
                    </div>
                </div>
                
                <div class="server-info" style="margin-top: 15px; padding-top: 15px;">
                    <div class="server-info-item">
                        <i class="fas fa-history"></i>
                        <span>Última actualización: <span id="lastUpdate">--:--:--</span></span>
                    </div>
                    <div class="server-info-item">
                        <i class="fas fa-database"></i>
                        <span>Logs: <span id="logCount">0</span></span>
                    </div>
                </div>
            </div>

            <!-- Card 4: Estadísticas Detalladas -->
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-chart-line"></i>
                        Estadísticas
                    </h3>
                    <button class="btn btn-secondary" onclick="showStatsModal()">
                        <i class="fas fa-expand-alt"></i>
                    </button>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">APIs Nativas</div>
                        <div class="stat-value" id="nativeAPICalls">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Caché</div>
                        <div class="stat-value" id="cacheSize">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Rate Limit</div>
                        <div class="stat-value" id="rateLimit">0</div>
                    </div>
                </div>

                <div style="margin-top: 20px;">
                    <h4 style="margin-bottom: 15px; color: var(--text-secondary); font-size: 14px;">
                        <i class="fas fa-bolt"></i> Actividad Reciente
                    </h4>
                    <div id="recentActivity" style="font-size: 13px; color: var(--text-tertiary);">
                        Esperando actividad...
                    </div>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="footer">
            <div class="footer-info">
                <div>
                    <i class="fas fa-code"></i> Mancy AI v3.0 • Panel de Control
                </div>
                <div>
                    <span id="currentTime">--:--:--</span> • 
                    <span id="connectionStatus">Conectando...</span>
                </div>
            </div>
            <div style="margin-top: 10px; font-size: 12px;">
                Sistema en tiempo real • Puerto: <span id="serverPort">11000</span> • 
                <a href="/" style="color: var(--primary); text-decoration: none;">API Docs</a>
            </div>
        </footer>
    </div>

    <!-- Notification -->
    <div id="notification" class="notification">
        <i class="fas fa-info-circle"></i>
        <span id="notificationMessage"></span>
    </div>

    <script>
        // Variables globales
        const API_BASE_URL = window.location.origin;
        let ws = null;
        let autoRefresh = true;
        let logs = [];
        let refreshInterval = null;

        // Mostrar notificación
        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            const icon = notification.querySelector('i');
            const messageSpan = document.getElementById('notificationMessage');
            
            switch(type) {
                case 'success':
                    icon.className = 'fas fa-check-circle';
                    break;
                case 'error':
                    icon.className = 'fas fa-exclamation-circle';
                    break;
                case 'warning':
                    icon.className = 'fas fa-exclamation-triangle';
                    break;
                default:
                    icon.className = 'fas fa-info-circle';
            }
            
            notification.className = `notification ${type}`;
            messageSpan.textContent = message;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 4000);
            
            addLog(message, type);
        }

        // Agregar log
        function addLog(message, type = 'info') {
            const logsContainer = document.getElementById('logsContainer');
            const now = new Date();
            const timeString = now.toLocaleTimeString('es-ES', { hour12: false });
            
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry';
            
            logEntry.innerHTML = `
                <div class="log-time">${timeString}</div>
                <div class="log-message">${message}</div>
                <div class="log-type ${type}">${type.toUpperCase()}</div>
            `;
            
            logsContainer.prepend(logEntry);
            logs.push({ time: timeString, message, type });
            
            // Actualizar contador
            document.getElementById('logCount').textContent = logs.length;
            
            // Limitar a 50 logs
            const logEntries = logsContainer.querySelectorAll('.log-entry');
            if (logEntries.length > 50) {
                logsContainer.removeChild(logEntries[logEntries.length - 1]);
            }
        }

        // Limpiar logs
        function clearLogs() {
            if (confirm('¿Estás seguro de que quieres limpiar todos los logs?')) {
                document.getElementById('logsContainer').innerHTML = `
                    <div class="log-entry">
                        <div class="log-time">${new Date().toLocaleTimeString('es-ES', { hour12: false })}</div>
                        <div class="log-message">Logs limpiados</div>
                        <div class="log-type info">INFO</div>
                    </div>
                `;
                logs = [];
                document.getElementById('logCount').textContent = '0';
                showNotification('Logs limpiados correctamente', 'success');
            }
        }

        // Alternar actualización automática
        function toggleAutoRefresh() {
            autoRefresh = !autoRefresh;
            const icon = document.getElementById('autoRefreshIcon');
            
            if (autoRefresh) {
                icon.style.color = 'var(--secondary)';
                showNotification('Actualización automática activada', 'success');
            } else {
                icon.style.color = 'var(--text-tertiary)';
                showNotification('Actualización automática desactivada', 'warning');
            }
        }

        // Controlar el bot
        async function controlBot(action) {
            const startBtn = document.getElementById('startBtn');
            const stopBtn = document.getElementById('stopBtn');
            const originalStartText = startBtn.innerHTML;
            const originalStopText = stopBtn.innerHTML;
            
            try {
                if (action === 'start') {
                    startBtn.disabled = true;
                    startBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Iniciando...';
                } else {
                    stopBtn.disabled = true;
                    stopBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Deteniendo...';
                }
                
                const response = await fetch(`${API_BASE_URL}/api/bot/${action}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showNotification(`Bot ${action === 'start' ? 'iniciado' : 'detenido'}`, 'success');
                    updateBotStatus();
                } else {
                    showNotification(data.message || 'Error desconocido', 'error');
                }
                
            } catch (error) {
                console.error('Error:', error);
                showNotification('Error de conexión con el servidor', 'error');
            } finally {
                setTimeout(() => {
                    startBtn.disabled = false;
                    stopBtn.disabled = false;
                    startBtn.innerHTML = originalStartText;
                    stopBtn.innerHTML = originalStopText;
                    updateBotStatus();
                }, 2000);
            }
        }

        // Actualizar estado del bot
        async function updateBotStatus() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/status`);
                const data = await response.json();
                
                const statusDot = document.getElementById('statusDot');
                const statusText = document.getElementById('statusText');
                const startBtn = document.getElementById('startBtn');
                const stopBtn = document.getElementById('stopBtn');
                
                if (data.bot && data.status === 'online') {
                    statusDot.className = 'status-dot online';
                    statusText.textContent = 'Bot Conectado';
                    startBtn.disabled = true;
                    stopBtn.disabled = false;
                    
                    // Actualizar estadísticas
                    document.getElementById('messageCount').textContent = data.messages || 0;
                    document.getElementById('commandCount').textContent = data.commands || 0;
                    document.getElementById('userCount').textContent = data.users || 0;
                    document.getElementById('serverCount').textContent = `${data.guilds || 0} servidores`;
                    document.getElementById('memoryUsers').textContent = `${data.memory_users || 0} usuarios`;
                    
                    // Actualizar barras de progreso
                    const memoryPercent = Math.min((data.memory_users || 0) / 100 * 100, 100);
                    document.getElementById('memoryPercent').textContent = `${memoryPercent}%`;
                    document.getElementById('memoryBar').style.width = `${memoryPercent}%`;
                    
                    // Actualizar estado de APIs
                    document.getElementById('discordStatus').className = 'api-status online';
                    document.getElementById('discordStatus').innerHTML = '<span class="status-dot-small"></span> Conectado';
                    
                } else {
                    statusDot.className = 'status-dot';
                    statusText.textContent = data.bot ? 'Bot Desconectado' : 'Bot No Cargado';
                    startBtn.disabled = false;
                    stopBtn.disabled = true;
                    
                    document.getElementById('discordStatus').className = 'api-status offline';
                    document.getElementById('discordStatus').innerHTML = '<span class="status-dot-small"></span> Desconectado';
                }
                
                // Actualizar Groq status
                document.getElementById('groqStatus').className = 'api-status online';
                
                // Actualizar tiempo de última actualización
                document.getElementById('lastUpdate').textContent = new Date().toLocaleTimeString('es-ES', { hour12: false });
                
            } catch (error) {
                console.error('Error updating status:', error);
                document.getElementById('statusText').textContent = 'Error de conexión';
            }
        }

        // Actualizar estadísticas del sistema
        async function updateSystemStats() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/stats`);
                const data = await response.json();
                
                if (data.bot) {
                    // Simular algunos datos para demostración
                    document.getElementById('nativeAPICalls').textContent = Math.floor(Math.random() * 100);
                    document.getElementById('cacheSize').textContent = Math.floor(Math.random() * 50);
                    document.getElementById('rateLimit').textContent = `${Math.floor(Math.random() * 10)}/10`;
                    
                    // Simular CPU y RAM
                    document.getElementById('cpuUsage').textContent = `${10 + Math.floor(Math.random() * 30)}%`;
                    document.getElementById('ramUsage').textContent = `${Math.floor(Math.random() * 500) + 100}MB`;
                    
                    // Simular ping
                    document.getElementById('pingTime').textContent = `${Math.floor(Math.random() * 200) + 50}ms`;
                    
                    // Simular uptime
                    const uptime = data.bot.uptime || 0;
                    const hours = Math.floor(uptime / 3600000);
                    const minutes = Math.floor((uptime % 3600000) / 60000);
                    const seconds = Math.floor((uptime % 60000) / 1000);
                    
                    document.getElementById('uptimeText').textContent = 
                        `${hours}h ${minutes}m ${seconds}s`;
                    
                    // Actualizar barra de uptime (max 24 horas)
                    const uptimePercent = Math.min((uptime / (24 * 3600000)) * 100, 100);
                    document.getElementById('uptimeBar').style.width = `${uptimePercent}%`;
                }
                
            } catch (error) {
                console.error('Error updating system stats:', error);
            }
        }

        // Actualizar hora actual
        function updateCurrentTime() {
            const now = new Date();
            document.getElementById('currentTime').textContent = now.toLocaleTimeString('es-ES', { hour12: false });
        }

        // Actualizar actividad reciente
        function updateRecentActivity() {
            const activities = [
                'Procesando comandos de usuarios',
                'Actualizando caché de APIs',
                'Sincronizando memoria',
                'Respondiendo consultas',
                'Verificando conexiones',
                'Generando estadísticas'
            ];
            
            const randomActivity = activities[Math.floor(Math.random() * activities.length)];
            document.getElementById('recentActivity').textContent = randomActivity;
        }

        // Refrescar todo
        function refreshAll() {
            updateBotStatus();
            updateSystemStats();
            updateRecentActivity();
            showNotification('Datos actualizados', 'info');
        }

        // Mostrar modal de estadísticas
        function showStatsModal() {
            alert('Estadísticas detalladas:\n\n' +
                  '• Mensajes procesados: ' + document.getElementById('messageCount').textContent + '\n' +
                  '• Comandos ejecutados: ' + document.getElementById('commandCount').textContent + '\n' +
                  '• Usuarios activos: ' + document.getElementById('userCount').textContent + '\n' +
                  '• Servidores: ' + document.getElementById('serverCount').textContent);
        }

        // Conectar WebSocket
        function connectWebSocket() {
            try {
                const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
                const wsUrl = `${protocol}//${window.location.host}/ws`;
                
                ws = new WebSocket(wsUrl);
                
                ws.onopen = () => {
                    console.log('WebSocket conectado');
                    document.getElementById('connectionStatus').textContent = 'Conectado (WebSocket)';
                    showNotification('Conectado al servidor en tiempo real', 'success');
                };
                
                ws.onmessage = (event) => {
                    try {
                        const data = JSON.parse(event.data);
                        handleWebSocketMessage(data);
                    } catch (error) {
                        console.error('Error parsing WebSocket message:', error);
                    }
                };
                
                ws.onclose = () => {
                    console.log('WebSocket desconectado');
                    document.getElementById('connectionStatus').textContent = 'Conectado (HTTP)';
                    
                    // Intentar reconectar después de 5 segundos
                    setTimeout(connectWebSocket, 5000);
                };
                
                ws.onerror = (error) => {
                    console.error('WebSocket error:', error);
                };
                
            } catch (error) {
                console.error('Error connecting WebSocket:', error);
                document.getElementById('connectionStatus').textContent = 'Solo HTTP';
            }
        }

        // Manejar mensajes WebSocket
        function handleWebSocketMessage(data) {
            switch(data.type) {
                case 'welcome':
                    addLog(data.message, 'success');
                    break;
                    
                case 'bot_status':
                    updateBotStatus();
                    addLog(`Bot: ${data.message || data.status}`, 'info');
                    break;
                    
                case 'stats_update':
                    // Actualizar estadísticas desde WebSocket
                    if (data.data) {
                        document.getElementById('messageCount').textContent = data.data.messageCount || 0;
                        document.getElementById('commandCount').textContent = data.data.commandCount || 0;
                    }
                    break;
                    
                case 'log':
                    addLog(data.message, data.level || 'info');
                    break;
                    
                case 'error':
                    addLog(data.message, 'error');
                    showNotification(data.message, 'error');
                    break;
            }
        }

        // Inicializar
        document.addEventListener('DOMContentLoaded', () => {
            console.log('Panel de Control Mancy AI inicializado');
            
            // Configurar puerto del servidor
            document.getElementById('serverPort').textContent = window.location.port || '11000';
            
            // Agregar logs iniciales
            addLog('Panel de control inicializado', 'success');
            addLog('Conectando al servidor...', 'info');
            
            // Inicializar conexiones
            updateBotStatus();
            updateSystemStats();
            connectWebSocket();
            
            // Configurar actualizaciones periódicas
            setInterval(() => {
                if (autoRefresh) {
                    updateBotStatus();
                    updateSystemStats();
                }
                updateCurrentTime();
                updateRecentActivity();
            }, 10000); // Cada 10 segundos
            
            // Actualizar hora cada segundo
            setInterval(updateCurrentTime, 1000);
            
            // Mostrar notificación de bienvenida
            setTimeout(() => {
                showNotification('Panel de Control Mancy AI listo', 'success');
            }, 1000);
            
            // Configurar hotkeys
            document.addEventListener('keydown', (e) => {
                // Ctrl+R para refrescar
                if (e.ctrlKey && e.key === 'r') {
                    e.preventDefault();
                    refreshAll();
                }
                
                // F5 también refresca
                if (e.key === 'F5') {
                    e.preventDefault();
                    refreshAll();
                }
            });
        });
    </script>
</body>
</html>
